<!DOCTYPE html>
<div id="artist" class="artist">
    Artist
</div>
<div id="title" class="title">
    Title
</div>
<br />
<div id="debug" class="debug">
    Debug logs:<br />
</div>

<script>
const dbg = document.getElementById("debug");
function printDebug(text) {
    if (dbg) {
        dbg.innerHTML += text + "<br />";
    }
}

const metadata = document.getElementsByTagName('meta');
function getMeta(name) {
    for (let i = 0; i < metadata.length; ++i) {
        if (metadata[i].getAttribute('name') === name) {
            return metadata[i].getAttribute('content');
        }
    }
    return '';
}

const port = getMeta('widgetport');
const artist = document.getElementById('artist');
const title = document.getElementById('title');

printDebug(port);

let socket = new WebSocket("ws://localhost:" + port + "/");
socket.onopen = function(e) {
    printDebug(`Connected to server at port ${port}`);
    socket.send("Hello server!");
    socket.send("Hi server! I am sending a very long message to make sure that long message receiving and payload extension code is working perfectly fine (I hope)");
}

socket.onclose = function(event) {
    if (event.wasClean) {
        printDebug(`Connection closed cleanly`);
    } else {
        printDebug(`Connection died`);
    }
}

socket.onerror = function(error) {
    printDebug(`Error: ${error.message}`);
}

socket.onmessage = function(event) {
    printDebug(`Msg: ${event.data}`);
}
</script>
